<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Fiscalização de Contratos Públicos</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <!-- PDF.js for PDF to canvas conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Tela de Login -->
    <div id="login-screen" class="login-container">
        <div class="card login-card">
            <div class="card__body">
                <div class="login-header">
                    <i class="fas fa-shield-alt login-icon"></i>
                    <h2>Sistema de Fiscalização</h2>
                    <p class="text-secondary">Contratos Públicos - Governo Federal</p>
                </div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="email" class="form-label">E-mail</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Senha</label>
                        <div class="password-input">
                            <input type="password" id="password" class="form-control" required>
                            <button type="button" class="password-toggle" onclick="togglePassword()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="profile" class="form-label">Perfil</label>
                        <select id="profile" class="form-control" required>
                            <option value="">Selecione seu perfil</option>
                            <option value="admin">Administrador</option>
                            <option value="fiscal_administrativo">Fiscal Administrativo</option>
                            <option value="fiscal_tecnico">Fiscal Técnico</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="remember-me">
                            <span class="checkmark"></span>
                            Lembrar-me
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn--primary btn--full-width">
                        <i class="fas fa-sign-in-alt"></i>
                        Entrar
                    </button>
                </form>
                
                <div class="login-demo">
                    <p><strong>Usuários de demonstração:</strong></p>
                    <p><small>admin@orgao.gov.br | fiscal.admin@orgao.gov.br | fiscal.tecnico@orgao.gov.br</small></p>
                    <p><small>Senha: 123456</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Seleção de Contrato -->
    <div id="contract-selection" class="main-container hidden">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>Seleção de Contrato</h1>
                    <p id="user-info" class="text-secondary"></p>
                </div>
                <button class="btn btn--outline" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>

        <div class="container">
            <div class="contract-search">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="contract-search" placeholder="Buscar por número ou objeto do contrato..." class="form-control">
                </div>
            </div>

            <div id="contracts-grid" class="contracts-grid">
                <!-- Contratos serão carregados dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="main-dashboard" class="main-container hidden">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1 id="dashboard-title">Dashboard</h1>
                    <nav class="breadcrumb">
                        <span id="current-contract-info"></span>
                    </nav>
                </div>
                <div class="header-actions">
                    <button class="btn btn--outline" onclick="showContractSelection()">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                    <button class="btn btn--outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Tabs Navigation -->
            <div class="tabs">
                <ul class="tabs-nav" id="dashboard-tabs">
                    <!-- Tabs serão carregadas dinamicamente baseadas no perfil -->
                </ul>
                
                <!-- Upload de Documentos -->
                <div id="upload-tab" class="tab-content active">
                    <div class="upload-section">
                        <h3>Upload de Documentos</h3>
        <!-- Contract Management -->
        <div class="contract-management">
            <h4>Gerenciar Contratos e Termos</h4>
            <div class="contract-forms">
                <form id="add-contract-form" class="small-form">
                    <h5>Adicionar Contrato</h5>
                    <input type="text" id="contract-number" placeholder="Número do Contrato" required>
                    <input type="text" id="contract-title" placeholder="Título do Contrato" required>
                    <input type="text" id="contract-contractor" placeholder="Contratado (nome/CNPJ)" required>
                    <input type="text" id="contract-value" placeholder="Valor (R$) - ex: 12345.67" required>
                    <input type="date" id="contract-start" placeholder="Data Início" required>
                    <input type="date" id="contract-end" placeholder="Data Término" required>
                    <button type="button" id="btn-add-contract">Adicionar Contrato</button>
                </form>

                <form id="add-aditivo-form" class="small-form">
                    <h5>Adicionar Termo Aditivo</h5>
                    <input type="text" id="aditivo-contract-number" placeholder="Número do Contrato (relacionar)" required>
                    <input type="text" id="aditivo-number" placeholder="Número do Termo Aditivo" required>
                    <input type="text" id="aditivo-value" placeholder="Valor Adicional (R$) - ex: 1234.56" required>
                    <input type="date" id="aditivo-date" placeholder="Data do Aditivo" required>
                    <button type="button" id="btn-add-aditivo">Adicionar Aditivo</button>
                </form>

                <form id="add-prorrogacao-form" class="small-form">
                    <h5>Adicionar Prorrogação</h5>
                    <input type="text" id="prorro-contract-number" placeholder="Número do Contrato (relacionar)" required>
                    <input type="date" id="prorro-new-end" placeholder="Nova data de término" required>
                    <input type="text" id="prorro-reason" placeholder="Motivo da Prorrogação" required>
                    <button type="button" id="btn-add-prorro">Adicionar Prorrogação</button>
                </form>
            </div>

            <div class="contract-list">
                <h5>Contratos Cadastrados</h5>
                <div id="contracts-container"></div>
            </div>
        </div>
        <!-- End Contract Management -->
        
                        
                        <div class="upload-area" id="upload-area">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <p>Arraste arquivos aqui ou <span class="upload-link">clique para selecionar</span></p>
                                <small>PDF, Excel, Imagens (JPG, PNG) - Máximo 10MB por arquivo</small>
                            </div>
                            <input type="file" id="file-input" multiple accept=".pdf,.xlsx,.xls,.jpg,.jpeg,.png" hidden>
                        </div>
                        
                        <div class="document-type-selector">
                            <label for="document-type" class="form-label">Tipo de Documento</label>
                            <select id="document-type" class="form-control">
                                <!-- Opções serão carregadas dinamicamente baseadas no perfil -->
                            </select>
                        </div>
                    </div>
                    
                    <div id="upload-queue" class="upload-queue hidden">
                        <h4>Fila de Processamento</h4>
                        <div id="upload-items"></div>
                    </div>
                </div>
                
                <!-- Validações -->
                <div id="validations-tab" class="tab-content">
                    <h3>Validações e Inconsistências</h3>
                    <div id="validations-content">
                        <div class="validation-summary">
                            <div class="stats-cards">
                                <div class="stat-card stat-success">
                                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="valid-docs">0</span>
                                        <span class="stat-label">Documentos Válidos</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card stat-error">
                                    <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="invalid-docs">0</span>
                                        <span class="stat-label">Com Inconsistências</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card stat-warning">
                                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="pending-docs">0</span>
                                        <span class="stat-label">Processando</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="inconsistencies-list" class="inconsistencies-list">
                            <!-- Lista de inconsistências será carregada dinamicamente -->
                        </div>
                    </div>
                </div>
                
                <!-- Relatórios -->
                <div id="reports-tab" class="tab-content">
                    <h3>Relatórios</h3>
                    <div class="reports-section">
                        <div class="report-controls">
                            <div class="form-group">
                                <label class="form-label">Período</label>
                                <div class="date-range">
                                    <input type="date" id="report-start-date" class="form-control">
                                    <span>até</span>
                                    <input type="date" id="report-end-date" class="form-control">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tipo de Relatório</label>
                                <select id="report-type" class="form-control">
                                    <option value="resumo">Relatório de Conformidade</option>
                                    <option value="detalhado">Relatório Detalhado</option>
                                    <option value="inconsistencias">Inconsistências por Documento</option>
                                </select>
                            </div>
                            
                            <button class="btn btn--primary" onclick="generateReport()">
                                <i class="fas fa-file-pdf"></i> Gerar Relatório
                            </button>
                        </div>
                        
                        <div id="report-preview" class="report-preview hidden">
                            <!-- Pré-visualização do relatório -->
                        </div>
                    </div>
                </div>
                
                <!-- Configurações (apenas Admin) -->
                <div id="config-tab" class="tab-content">
                    <h3>Configurações</h3>
                    <div class="config-section">
                        <div class="config-item">
                            <h4>Gerenciar Contratos</h4>
                            <button class="btn btn--primary" onclick="openAddContractModal()">
                                <i class="fas fa-plus"></i> Adicionar Contrato
                            </button>
                        </div>
                        
                        <div class="config-item">
                            <h4>Regras de Validação</h4>
                            <div id="rules-list">
                                <!-- Lista de regras será carregada dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar contrato -->
    <div id="add-contract-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Novo Contrato</h3>
                <button class="modal-close" onclick="closeModal('add-contract-modal')">&times;</button>
            </div>
            <form id="add-contract-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Número do Contrato</label>
                        <input type="text" id="new-contract-number" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objeto</label>
                        <textarea id="new-contract-object" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">CNPJ da Empresa</label>
                        <input type="text" id="new-contract-cnpj" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome da Empresa</label>
                        <input type="text" id="new-contract-company" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vigência - Início</label>
                        <input type="date" id="new-contract-start" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vigência - Fim</label>
                        <input type="date" id="new-contract-end" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor Mensal (R$)</label>
                        <input type="number" id="new-contract-value" class="form-control" step="0.01" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn--outline" onclick="closeModal('add-contract-modal')">Cancelar</button>
                    <button type="submit" class="btn btn--primary">Adicionar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loading-text">Carregando...</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>